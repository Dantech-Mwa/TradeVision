<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TradeVision Pro - Crypto & Trading News</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="icon" href="icon-192.png" type="image/png">
  <meta name="theme-color" content="#00d4ff">
  <meta property="og:title" content="TradeVision Pro - Real-Time Crypto News" />
  <meta property="og:description" content="Latest crypto, Bitcoin, and trading news from global sources." />
  <meta property="og:image" content="https://tradevision.jaydancosmeticshop.store/thumbnail.jpg" />
  <meta property="og:url" content="https://tradevision.jaydancosmeticshop.store/news.html" />
  <meta property="og:type" content="website" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <style>
    :root {
      --bg: #0f0f1a;
      --card-bg: #16213e;
      --text: #e0e0ff;
      --title: #00d4ff;
      --desc: #b0c4de;
      --border: #1e2a44;
      --accent: #00d4ff;
      --source-bg: #00d4ff;
      --source-text: #000;
      --alert: #ff6b6b;
      --price-up: #00ff88;
      --price-down: #ff6b6b;
    }
    [data-theme="light"] {
      --bg: #f8f9fa;
      --card-bg: #ffffff;
      --text: #212529;
      --title: #0066cc;
      --desc: #495057;
      --border: #dee2e6;
      --accent: #0066cc;
      --source-bg: #0066cc;
      --source-text: #fff;
      --alert: #dc3545;
      --price-up: #28a745;
      --price-down: #dc3545;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
      transition: background 0.3s, color 0.3s;
      min-height: 100vh;
    }

    .header {
      background: linear-gradient(135deg, #1a1a2e, #16213e);
      padding: 1rem;
      text-align: center;
      border-bottom: 3px solid var(--accent);
      position: sticky;
      top: 0;
      z-index: 100;
    }
    [data-theme="light"] .header {
      background: linear-gradient(135deg, #e3f2fd, #bbdefb);
    }
    .header h1 {
      font-size: 1.6rem;
      color: var(--accent);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .ticker-container {
      margin-top: 0.5rem;
      overflow: hidden;
      position: relative;
      height: 30px;
      /* Removed background to match header */
    }
    .ticker {
      display: flex;
      white-space: nowrap;
      position: absolute;
      /* Slower speed - 120 seconds for full cycle */
      animation: scrollTicker 120s linear infinite;
    }
    .ticker-item {
      display: flex;
      align-items: center;
      margin-right: 2rem;
      cursor: pointer;
      transition: all 0.2s;
      padding: 0.2rem 0.5rem;
      border-radius: 4px;
    }
    .ticker-item:hover {
      background: rgba(255, 255, 255, 0.1);
      transform: scale(1.05);
    }
    .ticker-symbol {
      font-weight: bold;
      margin-right: 0.3rem;
      font-size: 0.9rem;
    }
    .ticker-price {
      margin-right: 0.3rem;
      font-size: 0.9rem;
    }
    .ticker-change {
      font-size: 0.8rem;
      font-weight: bold;
    }
    @keyframes scrollTicker {
      0% { transform: translateX(100%); }
      100% { transform: translateX(-100%); }
    }
    
    .nav-links {
      margin-top: 0.6rem;
      display: flex;
      justify-content: center;
      gap: 1rem;
      flex-wrap: wrap;
      font-size: 0.9rem;
    }
    .nav-links a {
      color: #fff;
      text-decoration: none;
      padding: 0.3rem 0.6rem;
      border-radius: 6px;
    }
    [data-theme="light"] .nav-links a { color: #0066cc; }
    .nav-links a:hover { background: rgba(255,255,255,0.2); }

    .controls {
      max-width: 1200px;
      margin: 1rem auto;
      padding: 0 1rem;
      display: flex;
      flex-wrap: wrap;
      gap: 0.8rem;
      align-items: center;
      justify-content: space-between;
    }
    .search-box { flex: 1; min-width: 200px; }
    .search-box input {
      width: 100%;
      padding: 0.6rem 1rem;
      border: 1px solid var(--border);
      border-radius: 8px;
      background: var(--card-bg);
      color: var(--text);
      font-size: 0.95rem;
    }

    .theme-toggle, .alert-toggle {
      background: var(--accent);
      color: var(--source-text);
      border: none;
      padding: 0.5rem 0.9rem;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      font-size: 0.85rem;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: all 0.2s;
    }
    .theme-toggle:hover, .alert-toggle:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }

    .category-filter {
      max-width: 1200px;
      margin: 0.5rem auto 1rem;
      padding: 0 1rem;
      overflow-x: auto;
      white-space: nowrap;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
    }
    .category-filter::-webkit-scrollbar { display: none; }
    .category-filter .cat-btn {
      display: inline-block;
      background: var(--card-bg);
      color: var(--text);
      border: 1px solid var(--border);
      padding: 0.4rem 0.8rem;
      border-radius: 20px;
      font-size: 0.8rem;
      margin-right: 0.5rem;
      cursor: pointer;
      transition: 0.2s;
      white-space: nowrap;
    }
    .category-filter .cat-btn:hover {
      background: var(--accent);
      color: var(--source-text);
    }
    .category-filter .cat-btn.active {
      background: var(--accent);
      color: var(--source-text);
      font-weight: bold;
    }

    .container { max-width: 1200px; margin: 0 auto 2rem; padding: 0 1rem; }
    .news-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 1rem;
    }
    .news-card {
      background: var(--card-bg);
      border-radius: 10px;
      overflow: hidden;
      border: 1px solid var(--border);
      text-decoration: none;
      color: inherit;
      display: block;
      transition: transform 0.2s;
    }
    .news-card:hover { transform: translateY(-5px); }
    .news-card img {
      width: 100%;
      height: 160px;
      object-fit: cover;
      background: #111;
      transition: opacity 0.3s;
    }
    .news-card img.loading {
      opacity: 0.5;
    }
    .news-content { padding: 0.9rem; }
    .news-title {
      font-size: 1rem;
      font-weight: 600;
      color: var(--title);
      margin-bottom: 0.4rem;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    .news-desc {
      font-size: 0.85rem;
      color: var(--desc);
      margin-bottom: 0.6rem;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    .news-meta {
      font-size: 0.75rem;
      color: #888;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .loading-spinner {
      text-align: center;
      padding: 2rem;
      color: var(--accent);
    }
    .loading-spinner i {
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .alert-banner {
      position: fixed;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--alert);
      color: white;
      padding: 0.8rem 1.2rem;
      border-radius: 8px;
      font-weight: bold;
      z-index: 1000;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      animation: fadeIn 0.5s;
      max-width: 90%;
      text-align: center;
    }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    .back-btn {
      position: fixed;
      bottom: 15px;
      right: 15px;
      background: var(--accent);
      color: var(--source-text);
      width: 45px;
      height: 45px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.3rem;
      box-shadow: 0 4px 10px rgba(0, 212, 255, 0.4);
      z-index: 1000;
      text-decoration: none;
      transition: all 0.2s;
    }
    .back-btn:hover {
      transform: scale(1.1);
    }

    /* Modal Styles */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s;
    }
    .modal-overlay.active {
      opacity: 1;
      visibility: visible;
    }
    .modal {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 1.5rem;
      max-width: 500px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      transform: translateY(20px);
      transition: transform 0.3s;
    }
    .modal-overlay.active .modal {
      transform: translateY(0);
    }
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid var(--border);
    }
    .modal-title {
      font-size: 1.3rem;
      color: var(--title);
      font-weight: bold;
    }
    .modal-close {
      background: none;
      border: none;
      color: var(--text);
      font-size: 1.5rem;
      cursor: pointer;
      transition: color 0.2s;
    }
    .modal-close:hover {
      color: var(--alert);
    }
    .modal-content {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 0.8rem;
    }
    .asset-btn {
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 0.8rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
    }
    .asset-btn:hover {
      background: var(--accent);
      color: var(--source-text);
      transform: translateY(-2px);
    }
    .asset-btn.active {
      background: var(--accent);
      color: var(--source-text);
      font-weight: bold;
    }
    .asset-symbol {
      font-weight: bold;
      font-size: 1.1rem;
      margin-bottom: 0.3rem;
    }
    .asset-name {
      font-size: 0.8rem;
      opacity: 0.8;
    }

    @media (max-width: 592px) {
      .header h1 { font-size: 1.4rem; }
      .ticker-container { height: 25px; }
      .ticker-item { margin-right: 1.5rem; padding: 0.1rem 0.3rem; }
      .ticker-symbol, .ticker-price { font-size: 0.8rem; }
      .ticker-change { font-size: 0.75rem; }
      .nav-links { font-size: 0.8rem; gap: 0.6rem; }
      .controls { flex-direction: column; align-items: stretch; }
      .search-box { min-width: 100%; }
      .theme-toggle, .alert-toggle { font-size: 0.8rem; padding: 0.5rem; }
      .news-grid { grid-template-columns: 1fr; }
      .news-card img { height: 140px; }
      .back-btn { width: 40px; height: 40px; font-size: 1.1rem; }
      .modal-content { grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); }
    }
  </style>
</head>
<body data-theme="dark">

  <div class="header">
    <h1><i class="fas fa-newspaper"></i> TradeVision News</h1>
    <div class="ticker-container">
      <div class="ticker" id="ticker">
        <!-- Ticker items will be populated by JavaScript -->
      </div>
    </div>
    <div class="nav-links">
      <a href="index.html"><i class="fas fa-home"></i> Home</a>
      <a href="chart.html"><i class="fas fa-chart-line"></i> Chart</a>
      <a href="news.html"><i class="fas fa-newspaper"></i> News</a>
    </div>
  </div>

  <div class="controls">
    <div class="search-box">
      <input type="text" id="search" placeholder="Search news..." autocomplete="off">
    </div>
    <button class="theme-toggle" id="theme-toggle"><i class="fas fa-moon"></i> Dark</button>
    <button class="alert-toggle" id="alert-toggle"><i class="fas fa-bell"></i> Alerts: Off</button>
  </div>

  <div class="category-filter">
    <button class="cat-btn active" data-cat="all">All</button>
    <button class="cat-btn" data-cat="BTC">BTC</button>
    <button class="cat-btn" data-cat="ETH">ETH</button>
    <button class="cat-btn" data-cat="SOL">SOL</button>
    <button class="cat-btn" data-cat="ADA">ADA</button>
    <button class="cat-btn" data-cat="XRP">XRP</button>
    <button class="cat-btn" data-cat="DeFi">DeFi</button>
    <button class="cat-btn" data-cat="NFT">NFT</button>
    <button class="cat-btn" data-cat="Trading">Trading</button>
    <button class="cat-btn" data-cat="Stocks">Stocks</button>
  </div>

  <div class="container">
    <div id="news-container" class="news-grid">
      <!-- News cards will be populated by JavaScript -->
    </div>
    <div id="loading-spinner" class="loading-spinner" style="display: none;">
      <i class="fas fa-spinner"></i> Loading more news...
    </div>
  </div>

  <a href="chart.html" class="back-btn">
    <i class="fas fa-chart-line"></i>
  </a>

  <!-- Asset Selection Modal -->
  <div class="modal-overlay" id="asset-modal">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title">Select Assets to Track</h2>
        <button class="modal-close" id="modal-close">&times;</button>
      </div>
      <div class="modal-content" id="asset-list">
        <!-- Asset buttons will be populated by JavaScript -->
      </div>
    </div>
  </div>

  <!-- Service Worker -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('sw.js');
      });
    }
  </script>

  <script>
    // === CONFIG ===
    const PLACEHOLDER_IMAGE = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjgwIiBoZWlnaHQ9IjE2MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjMTYyMTNlIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZmlsbD0iI2UwZTBmZiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPkxvYWRpbmcuLi48L3RleHQ+PC9zdmc+';
    
    // Top 100+ crypto assets by market cap
    const AVAILABLE_ASSETS = [
      { id: 'bitcoin', symbol: 'BTC', name: 'Bitcoin' },
      { id: 'ethereum', symbol: 'ETH', name: 'Ethereum' },
      { id: 'tether', symbol: 'USDT', name: 'Tether' },
      { id: 'binancecoin', symbol: 'BNB', name: 'BNB' },
      { id: 'solana', symbol: 'SOL', name: 'Solana' },
      { id: 'usd-coin', symbol: 'USDC', name: 'USD Coin' },
      { id: 'xrp', symbol: 'XRP', name: 'XRP' },
      { id: 'cardano', symbol: 'ADA', name: 'Cardano' },
      { id: 'dogecoin', symbol: 'DOGE', name: 'Dogecoin' },
      { id: 'shiba-inu', symbol: 'SHIB', name: 'Shiba Inu' },
      { id: 'avalanche-2', symbol: 'AVAX', name: 'Avalanche' },
      { id: 'polkadot', symbol: 'DOT', name: 'Polkadot' },
      { id: 'chainlink', symbol: 'LINK', name: 'Chainlink' },
      { id: 'tron', symbol: 'TRX', name: 'TRON' },
      { id: 'polygon-pos', symbol: 'MATIC', name: 'Polygon' },
      { id: 'toncoin', symbol: 'TON', name: 'Toncoin' },
      { id: 'bitcoin-cash', symbol: 'BCH', name: 'Bitcoin Cash' },
      { id: 'litecoin', symbol: 'LTC', name: 'Litecoin' },
      { id: 'uniswap', symbol: 'UNI', name: 'Uniswap' },
      { id: 'dai', symbol: 'DAI', name: 'Dai' },
      { id: 'internet-computer', symbol: 'ICP', name: 'Internet Computer' },
      { id: 'ethereum-classic', symbol: 'ETC', name: 'Ethereum Classic' },
      { id: 'stellar', symbol: 'XLM', name: 'Stellar' },
      { id: 'cosmos', symbol: 'ATOM', name: 'Cosmos' },
      { id: 'monero', symbol: 'XMR', name: 'Monero' },
      { id: 'okb', symbol: 'OKB', name: 'OKB' },
      { id: 'filecoin', symbol: 'FIL', name: 'Filecoin' },
      { id: 'aptos', symbol: 'APT', name: 'Aptos' },
      { id: 'hedera-hashgraph', symbol: 'HBAR', name: 'Hedera' },
      { id: 'crypto-com-chain', symbol: 'CRO', name: 'Cronos' },
      { id: 'lido-dao', symbol: 'LDO', name: 'Lido DAO' },
      { id: 'arbitrum', symbol: 'ARB', name: 'Arbitrum' },
      { id: 'vechain', symbol: 'VET', name: 'VeChain' },
      { id: 'near', symbol: 'NEAR', name: 'NEAR Protocol' },
      { id: 'the-graph', symbol: 'GRT', name: 'The Graph' },
      { id: 'aave', symbol: 'AAVE', name: 'Aave' },
      { id: 'maker', symbol: 'MKR', name: 'Maker' },
      { id: 'quant-network', symbol: 'QNT', name: 'Quant' },
      { id: 'algorand', symbol: 'ALGO', name: 'Algorand' },
      { id: 'optimism', symbol: 'OP', name: 'Optimism' },
      { id: 'the-sandbox', symbol: 'SAND', name: 'The Sandbox' },
      { id: 'eos', symbol: 'EOS', name: 'EOS' },
      { id: 'elrond-erd-2', symbol: 'EGLD', name: 'MultiversX' },
      { id: 'tezos', symbol: 'XTZ', name: 'Tezos' },
      { id: 'theta-token', symbol: 'THETA', name: 'Theta Network' },
      { id: 'rocket-pool', symbol: 'RPL', name: 'Rocket Pool' },
      { id: 'immutable-x', symbol: 'IMX', name: 'Immutable X' },
      { id: 'decentraland', symbol: 'MANA', name: 'Decentraland' },
      { id: 'axie-infinity', symbol: 'AXS', name: 'Axie Infinity' },
      { id: 'flow', symbol: 'FLOW', name: 'Flow' },
      { id: 'kava', symbol: 'KAVA', name: 'Kava' },
      { id: 'gala', symbol: 'GALA', name: 'Gala' },
      { id: 'chiliz', symbol: 'CHZ', name: 'Chiliz' },
      { id: 'curve-dao-token', symbol: 'CRV', name: 'Curve DAO' },
      { id: 'mina-protocol', symbol: 'MINA', name: 'Mina' },
      { id: 'kusama', symbol: 'KSM', name: 'Kusama' },
      { id: 'compound-governance-token', symbol: 'COMP', name: 'Compound' },
      { id: 'theta-fuel', symbol: 'TFUEL', name: 'Theta Fuel' },
      { id: 'zcash', symbol: 'ZEC', name: 'Zcash' },
      { id: 'dash', symbol: 'DASH', name: 'Dash' },
      { id: 'enjincoin', symbol: 'ENJ', name: 'Enjin' },
      { id: 'nexo', symbol: 'NEXO', name: 'Nexo' },
      { id: 'basic-attention-token', symbol: 'BAT', name: 'Basic Attention' },
      { id: 'oec-token', symbol: 'OKT', name: 'OKC Token' },
      { id: 'holotoken', symbol: 'HOT', name: 'Holo' },
      { id: 'harmony', symbol: 'ONE', name: 'Harmony' },
      { id: 'celo', symbol: 'CELO', name: 'Celo' },
      { id: 'iotex', symbol: 'IOTX', name: 'IoTeX' },
      { id: 'omisego', symbol: 'OMG', name: 'OMG Network' },
      { id: '0x', symbol: 'ZRX', name: '0x' },
      { id: 'reserve-rights-token', symbol: 'RSR', name: 'Reserve Rights' },
      { id: 'ankr', symbol: 'ANKR', name: 'Ankr' },
      { id: 'icon', symbol: 'ICX', name: 'ICON' },
      { id: 'wax', symbol: 'WAXP', name: 'WAX' },
      { id: 'synthetix-network-token', symbol: 'SNX', name: 'Synthetix' },
      { id: 'skale', symbol: 'SKL', name: 'SKALE' },
      { id: 'serum', symbol: 'SRM', name: 'Serum' },
      { id: 'ultra', symbol: 'UOS', name: 'Ultra' },
      { id: 'digibyte', symbol: 'DGB', name: 'DigiByte' },
      { id: 'numeraire', symbol: 'NMR', name: 'Numeraire' },
      { id: 'keep-network', symbol: 'KEEP', name: 'Keep Network' },
      { id: 'origin-protocol', symbol: 'OGN', name: 'Origin Protocol' },
      { id: 'band-protocol', symbol: 'BAND', name: 'Band Protocol' },
      { id: 'augur', symbol: 'REP', name: 'Augur' },
      { id: 'uma', symbol: 'UMA', name: 'UMA' },
      { id: 'kyber-network', symbol: 'KNC', name: 'Kyber Network' },
      { id: 'balancer', symbol: 'BAL', name: 'Balancer' },
      { id: 'sushi', symbol: 'SUSHI', name: 'SushiSwap' },
      { id: 'yearn-finance', symbol: 'YFI', name: 'yearn.finance' },
      { id: 'bancor', symbol: 'BNT', name: 'Bancor' },
      { id: 'loopring', symbol: 'LRC', name: 'Loopring' },
      { id: 'arweave', symbol: 'AR', name: 'Arweave' },
      { id: 'injective-protocol', symbol: 'INJ', name: 'Injective' },
      { id: 'kadena', symbol: 'KDA', name: 'Kadena' },
      { id: 'raydium', symbol: 'RAY', name: 'Raydium' },
      { id: 'orchid-protocol', symbol: 'OXT', name: 'Orchid' },
      { id: 'livepeer', symbol: 'LPT', name: 'Livepeer' },
      { id: 'nervos-network', symbol: 'CKB', name: 'Nervos Network' },
      { id: 'hive', symbol: 'HIVE', name: 'Hive' },
      { id: 'dent', symbol: 'DENT', name: 'Dent' },
      { id: 'stormx', symbol: 'STMX', name: 'StormX' },
      { id: 'funfair', symbol: 'FUN', name: 'FunFair' },
      { id: 'district0x', symbol: 'DNT', name: 'district0x' }
    ];

    // User selected assets (default to first 20 for better performance)
    let userAssets = JSON.parse(localStorage.getItem('userAssets')) || AVAILABLE_ASSETS.slice(0, 20).map(a => a.id);

    let allArticles = JSON.parse(localStorage.getItem('cachedArticles')) || [];
    let currentCategory = 'all';
    let alertsEnabled = false;
    let lastAlertTime = 0;
    let currentPage = 0;
    let isLoading = false;
    let hasMoreNews = true;

    // === IMMEDIATE TICKER DISPLAY ===
    function initializeTicker() {
      const ticker = document.getElementById('ticker');
      let tickerHTML = '';
      
      // Show placeholder data immediately
      userAssets.forEach(assetId => {
        const asset = AVAILABLE_ASSETS.find(a => a.id === assetId);
        if (asset) {
          tickerHTML += `
            <div class="ticker-item">
              <span class="ticker-symbol">${asset.symbol}</span>
              <span class="ticker-price">$--</span>
              <span class="ticker-change">--%</span>
            </div>
          `;
        }
      });
      
      // Duplicate content for seamless scrolling
      ticker.innerHTML = tickerHTML + tickerHTML;
      
      // Then update with real data
      updateTicker();
    }

    // === MODAL FUNCTIONALITY ===
    const assetModal = document.getElementById('asset-modal');
    const modalClose = document.getElementById('modal-close');
    const assetList = document.getElementById('asset-list');
    const tickerContainer = document.querySelector('.ticker-container');

    // Open modal when clicking on ticker
    tickerContainer.addEventListener('click', () => {
      assetModal.classList.add('active');
      renderAssetList();
    });

    // Close modal
    modalClose.addEventListener('click', () => {
      assetModal.classList.remove('active');
    });

    // Close modal when clicking outside
    assetModal.addEventListener('click', (e) => {
      if (e.target === assetModal) {
        assetModal.classList.remove('active');
      }
    });

    // Render asset selection list
    function renderAssetList() {
      assetList.innerHTML = AVAILABLE_ASSETS.map(asset => `
        <div class="asset-btn ${userAssets.includes(asset.id) ? 'active' : ''}" data-id="${asset.id}">
          <div class="asset-symbol">${asset.symbol}</div>
          <div class="asset-name">${asset.name}</div>
        </div>
      `).join('');
      
      // Add event listeners to asset buttons
      document.querySelectorAll('.asset-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const assetId = btn.dataset.id;
          if (userAssets.includes(assetId)) {
            // Remove asset if already selected
            userAssets = userAssets.filter(id => id !== assetId);
            btn.classList.remove('active');
          } else {
            // Add asset if not selected
            userAssets.push(assetId);
            btn.classList.add('active');
          }
          // Save user selection
          localStorage.setItem('userAssets', JSON.stringify(userAssets));
          // Update ticker
          initializeTicker();
        });
      });
    }

    // === MULTI-ASSET TICKER ===
    async function updateTicker() {
      try {
        // Get user selected assets
        const selectedAssets = AVAILABLE_ASSETS.filter(a => userAssets.includes(a.id));
        const ids = selectedAssets.map(a => a.id).join(',');
        
        const res = await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=${ids}&vs_currencies=usd&include_24hr_change=true`);
        if (!res.ok) throw new Error('Failed to fetch ticker data');
        const data = await res.json();
        
        let tickerHTML = '';
        
        selectedAssets.forEach(asset => {
          if (data[asset.id]) {
            const price = data[asset.id].usd;
            const change = data[asset.id].usd_24h_change;
            const changeColor = change >= 0 ? 'var(--price-up)' : 'var(--price-down)';
            const changeSymbol = change >= 0 ? '+' : '';
            
            tickerHTML += `
              <div class="ticker-item">
                <span class="ticker-symbol">${asset.symbol}</span>
                <span class="ticker-price">$${price.toLocaleString(undefined, { maximumFractionDigits: 2 })}</span>
                <span class="ticker-change" style="color: ${changeColor}">${changeSymbol}${change.toFixed(2)}%</span>
              </div>
            `;
          }
        });
        
        // Duplicate content for seamless scrolling
        document.getElementById('ticker').innerHTML = tickerHTML + tickerHTML;
      } catch (e) {
        console.warn('Ticker update failed:', e);
      }
    }

    // === UTILS ===
    function getDomain(url) {
      try { return new URL(url).hostname; } catch { return 'unknown'; }
    }

    // === FAST IMAGE LOADING ===
    function loadImage(imgElement, src) {
      return new Promise((resolve) => {
        // Show placeholder immediately
        imgElement.src = PLACEHOLDER_IMAGE;
        imgElement.classList.add('loading');
        
        const img = new Image();
        img.onload = () => {
          imgElement.src = src;
          imgElement.classList.remove('loading');
          resolve();
        };
        img.onerror = () => {
          imgElement.classList.remove('loading');
          resolve();
        };
        img.src = src;
      });
    }

    // === INFINITE SCROLL NEWS ===
    async function fetchNews(page = 0) {
      if (isLoading) return [];
      
      try {
        isLoading = true;
        document.getElementById('loading-spinner').style.display = 'block';
        
        // Simulate pagination with different sources
        const sources = [
          `https://cryptopanic.com/api/v1/posts/?public=true&currencies=BTC,ETH,SOL,ADA,XRP&kind=news&filter=hot&page=${page + 1}`,
          `https://api.rss2json.com/v1/api.json?rss_url=https%3A%2F%2Fcointelegraph.com%2Frss&page=${page + 1}`,
          `https://api.rss2json.com/v1/api.json?rss_url=https%3A%2F%2Fwww.coindesk.com%2Farc%2Foutboundfeeds%2Frss%2F&page=${page + 1}`
        ];
        
        const responses = await Promise.allSettled(
          sources.map(url => 
            fetch(url).then(res => res.ok ? res.json() : Promise.reject('API error'))
          )
        );
        
        let articles = [];
        
        // Process CryptoPanic response
        const cryptoPanic = responses[0];
        if (cryptoPanic.status === 'fulfilled' && cryptoPanic.value.results) {
          articles = articles.concat(cryptoPanic.value.results.map(item => ({
            title: item.title,
            description: (item.description || '').substring(0, 150) + '...',
            url: item.url,
            image: item.image?.url || PLACEHOLDER_IMAGE,
            publishedAt: item.published_at,
            id: item.id + page,
            category: 'crypto'
          })));
        }
        
        // Process RSS feeds
        for (let i = 1; i < responses.length; i++) {
          const rss = responses[i];
          if (rss.status === 'fulfilled' && rss.value.items) {
            articles = articles.concat(rss.value.items.map(item => ({
              title: item.title,
              description: (item.description || '').replace(/<[^>]*>/g, '').substring(0, 150) + '...',
              url: item.link,
              image: item.thumbnail || PLACEHOLDER_IMAGE,
              publishedAt: item.pubDate,
              id: item.link + page,
              category: 'crypto'
            })));
          }
        }
        
        // Deduplicate articles
        articles = articles.filter((a, index, self) => 
          index === self.findIndex(t => t.id === a.id)
        );
        
        // Sort by date
        articles.sort((a, b) => new Date(b.publishedAt) - new Date(a.publishedAt));
        
        // Check if we have more articles
        hasMoreNews = articles.length > 0;
        
        return articles;
      } catch (error) {
        console.error('Error fetching news:', error);
        return [];
      } finally {
        isLoading = false;
        document.getElementById('loading-spinner').style.display = 'none';
      }
    }

    // === INFINITE SCROLL HANDLER ===
    function setupInfiniteScroll() {
      window.addEventListener('scroll', () => {
        if (isLoading || !hasMoreNews) return;
        
        const { scrollTop, scrollHeight, clientHeight } = document.documentElement;
        
        // Load more when 80% from bottom
        if (scrollTop + clientHeight >= scrollHeight - 500) {
          loadMoreNews();
        }
      });
    }

    async function loadMoreNews() {
      currentPage++;
      const newArticles = await fetchNews(currentPage);
      
      if (newArticles.length > 0) {
        allArticles = [...allArticles, ...newArticles];
        localStorage.setItem('cachedArticles', JSON.stringify(allArticles));
        renderNews(allArticles);
      }
    }

    // === FILTERING ===
    document.querySelectorAll('.cat-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentCategory = btn.dataset.cat;
        applyFilters();
      });
    });

    document.getElementById('search').addEventListener('input', applyFilters);

    function applyFilters() {
      let filtered = allArticles;
      const query = document.getElementById('search').value.toLowerCase();

      if (query) {
        filtered = filtered.filter(a =>
          a.title.toLowerCase().includes(query) ||
          a.description.toLowerCase().includes(query)
        );
      }

      if (currentCategory !== 'all') {
        const keywords = {
          BTC: ['bitcoin', 'btc'],
          ETH: ['ethereum', 'eth'],
          SOL: ['solana', 'sol'],
          ADA: ['cardano', 'ada'],
          XRP: ['xrp', 'ripple'],
          DeFi: ['defi', 'lending', 'yield', 'uniswap', 'aave'],
          NFT: ['nft', 'opensea', 'collectible', 'mint'],
          Trading: ['trading', 'strategy', 'chart', 'analysis', 'market'],
          Stocks: ['stock', 'nasdaq', 's&p', 'dow jones', 'tsla', 'aapl', 'msft', 'amzn', 'googl']
        };
        const terms = keywords[currentCategory] || [];
        filtered = filtered.filter(a =>
          terms.some(t => a.title.toLowerCase().includes(t) || a.description.toLowerCase().includes(t))
        );
      }

      renderNews(filtered);
    }

    // === RENDER NEWS ===
    function renderNews(articles) {
      const container = document.getElementById('news-container');
      
      if (articles.length === 0) {
        container.innerHTML = '<div class="error">No matching news found.</div>';
        return;
      }
      
      container.innerHTML = articles.map(a => `
        <a href="${a.url}" target="_blank" class="news-card">
          <img src="${PLACEHOLDER_IMAGE}" alt="${a.title}" loading="lazy" data-src="${a.image}">
          <div class="news-content">
            <div class="news-title">${a.title}</div>
            <div class="news-desc">${a.description}</div>
            <div class="news-meta">
              <span>${new Date(a.publishedAt).toLocaleDateString()}</span>
            </div>
          </div>
        </a>
      `).join('');
      
      // Load images after rendering
      setTimeout(() => {
        document.querySelectorAll('.news-card img').forEach(img => {
          const src = img.getAttribute('data-src');
          if (src) loadImage(img, src);
        });
      }, 100);
    }

    // === ALERTS ===
    document.getElementById('alert-toggle').addEventListener('click', async () => {
      if (!alertsEnabled) {
        if ('Notification' in window && Notification.permission === 'default') {
          const perm = await Notification.requestPermission();
          if (perm !== 'granted') return alert('Enable notifications in browser');
        }
        alertsEnabled = true;
        document.getElementById('alert-toggle').innerHTML = '<i class="fas fa-bell"></i> Alerts: On';
      } else {
        alertsEnabled = false;
        document.getElementById('alert-toggle').innerHTML = '<i class="fas fa-bell-slash"></i> Alerts: Off';
      }
    });

    function showAlert(title) {
      const now = Date.now();
      if (now - lastAlertTime < 30000) return;
      lastAlertTime = now;
      if (alertsEnabled && 'Notification' in window && Notification.permission === 'granted') {
        new Notification(title, { icon: 'icon-192.png' });
      }
      const banner = Object.assign(document.createElement('div'), {
        className: 'alert-banner',
        innerHTML: `<i class="fas fa-exclamation-triangle"></i> ${title}`
      });
      document.body.appendChild(banner);
      setTimeout(() => banner.remove(), 5000);
    }

    // === THEME TOGGLE ===
    const body = document.body;
    const savedTheme = localStorage.getItem('theme') || 'dark';
    body.setAttribute('data-theme', savedTheme);
    const themeBtn = document.getElementById('theme-toggle');
    themeBtn.innerHTML = savedTheme === 'dark' ? '<i class="fas fa-moon"></i> Dark' : '<i class="fas fa-sun"></i> Light';

    themeBtn.addEventListener('click', () => {
      const newTheme = body.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
      body.setAttribute('data-theme', newTheme);
      localStorage.setItem('theme', newTheme);
      themeBtn.innerHTML = newTheme === 'dark' ? '<i class="fas fa-moon"></i> Dark' : '<i class="fas fa-sun"></i> Light';
    });

    // === INITIAL LOAD ===
    window.addEventListener('load', async () => {
      // Initialize ticker immediately
      initializeTicker();
      
      // Setup infinite scroll
      setupInfiniteScroll();
      
      // Load cached articles if available
      if (allArticles.length > 0) {
        renderNews(allArticles);
      }
      
      // Fetch initial news
      const freshArticles = await fetchNews(0);
      if (freshArticles.length > 0) {
        allArticles = freshArticles;
        localStorage.setItem('cachedArticles', JSON.stringify(allArticles));
        applyFilters();
        
        // Check for breaking news alerts
        freshArticles.forEach(a => {
          const lower = (a.title + a.description).toLowerCase();
          if (lower.includes('breaking') || lower.includes('urgent') || lower.includes('crash') || lower.includes('surge') || lower.includes('all-time high')) {
            showAlert(a.title);
          }
        });
      } else if (allArticles.length === 0) {
        // Show fallback content if no articles loaded
        renderNews([{
          title: 'Welcome to TradeVision News',
          description: 'Latest crypto updates loading soon...',
          image: PLACEHOLDER_IMAGE,
          publishedAt: new Date().toISOString(),
          url: '#',
          id: 'fallback'
        }]);
      }
    });

    // Auto-refresh ticker every 30 seconds
    setInterval(updateTicker, 30000);
  </script>
</body>
</html>
