<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Indicators – TradeVision</title>
  <link rel="icon" href="assets/icons/chart.svg" type="image/svg+xml">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    :root{
      --bg:#141518;--bg-light:#1e222d;--text:#d1d4dc;--text-light:#9ea1b5;
      --accent:#2962ff;--green:#26a69a;--red:#ef5350;--border:#2d313e;--card:#1e222d;
      --sidebar-bg:#1a1d29;--sidebar-hover:#252932;--sidebar-active:#2962ff;
    }
    [data-theme="light"]{
      --bg:#ffffff;--bg-light:#f8f9fa;--text:#2d3748;--text-light:#718096;
      --accent:#2962ff;--green:#26a69a;--red:#ef5350;--border:#e2e8f0;--card:#ffffff;
      --sidebar-bg:#f1f3f5;--sidebar-hover:#e2e8f0;--sidebar-active:#2962ff;
    }
    *,*::before,*::after{box-sizing:border-box;}
    body{margin:0;font-family:'Inter',sans-serif;background:var(--bg);color:var(--text);}
    a{color:var(--accent);text-decoration:none;}
    .container{max-width:1400px;margin:0 auto;padding:2rem 1rem;}
    .header{background:var(--bg-light);border-bottom:1px solid var(--border);padding:.75rem 0;position:sticky;top:0;z-index:100;}
    .flex-between{display:flex;justify-content:space-between;align-items:center;}
    .logo{font-weight:700;font-size:1.4rem;color:var(--accent);}
    .logo i{font-size:1.5rem;}
    .nav-links a{margin:0 .75rem;font-weight:500;}
    .icon-btn{background:none;border:none;color:var(--text-light);font-size:1.2rem;cursor:pointer;padding:.5rem;}

    /* Panel Layout */
    .panel{display:flex;gap:1.5rem;height:calc(100vh - 120px);}
    .sidebar{width:260px;flex-shrink:0;background:var(--sidebar-bg);border-radius:12px;padding:1rem;overflow-y:auto;}
    .sidebar h3{font-size:.85rem;font-weight:600;color:var(--text-light);margin:1.5rem 0 .5rem;text-transform:uppercase;letter-spacing:.5px;}
    .sidebar ul{list-style:none;padding:0;margin:0;}
    .sidebar li{
      padding:.75rem 1rem;cursor:pointer;border-radius:8px;margin-bottom:.25rem;
      font-weight:500;display:flex;align-items:center;gap:.5rem;transition:.2s;
    }
    .sidebar li:hover{background:var(--sidebar-hover);}
    .sidebar li.active{background:var(--sidebar-active);color:white;}
    .sidebar li i{font-size:1rem;}

    .main{flex:1;overflow:hidden;display:flex;flex-direction:column;}
    .top-bar{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:1rem;margin-bottom:1rem;position:relative;}
    .search-input{
      width:100%;padding:.75rem 1rem .75rem 2.5rem;border:none;background:transparent;
      color:var(--text);font-size:1rem;
    }
    .search-input:focus{outline:none;}
    .search-icon{position:absolute;left:.75rem;top:50%;transform:translateY(-50%);color:var(--text-light);}

    .tabs{display:flex;gap:0;border-bottom:1px solid var(--border);margin-bottom:1rem;}
    .tab-btn{
      padding:.75rem 1.5rem;border:none;background:none;color:var(--text-light);
      font-weight:500;cursor:pointer;position:relative;transition:color .2s;
    }
    .tab-btn:hover{color:var(--text);}
    .tab-btn.active{color:var(--accent);font-weight:600;}
    .tab-btn.active::after{
      content:'';position:absolute;bottom:-1px;left:0;right:0;height:2px;
      background:var(--accent);border-radius:1px;
    }

    .content{flex:1;overflow-y:auto;padding-right:.5rem;}
    .indicator-list{list-style:none;padding:0;margin:0;}
    .indicator-item{
      padding:.75rem 1rem;cursor:pointer;border-bottom:1px solid var(--border);
      display:flex;justify-content:space-between;align-items:center;
      transition:.2s;
    }
    .indicator-item:hover{background:var(--bg-light);}
    .indicator-item .name{font-weight:500;}
    .indicator-item .new{
      background:#ff9800;color:white;padding:.2rem .4rem;font-size:.65rem;
      border-radius:4px;margin-left:.5rem;
    }
    .indicator-item .add-btn{
      background:var(--accent);color:white;border:none;border-radius:4px;
      width:28px;height:28px;font-size:.9rem;cursor:pointer;
      transition:background-color 0.2s;
    }
    .indicator-item .add-btn:hover{
      background:#1e53e5;
    }

    .empty-state{
      text-align:center;padding:3rem;color:var(--text-light);
    }
    .empty-state i{font-size:3rem;margin-bottom:1rem;opacity:.5;}

    .footer{background:var(--bg-light);border-top:1px solid var(--border);padding:1rem 0;font-size:.8rem;text-align:center;color:var(--text-light);}
  </style>
</head>

<body data-theme="dark">

<header class="header">
  <div class="container flex-between">
    <div class="logo"><a href="index.html"><i class="fas fa-chart-line"></i> TradeVision</a></div>
    <nav class="nav-links">
      <a href="chart.html">Chart</a>
      <a href="watchlist.html">Watchlist</a>
      <a href="screener.html">Screener</a>
      <a href="ideas.html">Ideas</a>
      <a href="alerts.html">Alerts</a>
    </nav>
    <button id="theme-toggle" class="icon-btn"><i class="fas fa-moon"></i></button>
  </div>
</header>

<div class="container">
  <h1 style="margin-bottom:.5rem;">Indicators, metrics, and strategies</h1>

  <div class="panel">
    <!-- Sidebar -->
    <div class="sidebar">
      <h3>Personal</h3>
      <ul>
        <li data-section="my-scripts"><i class="fas fa-user"></i> My scripts</li>
        <li data-section="invite-only"><i class="fas fa-lock"></i> Invite-only</li>
      </ul>

      <h3>Built-in</h3>
      <ul>
        <li class="active" data-section="technicals"><i class="fas fa-chart-line"></i> Technicals</li>
        <li data-section="financials"><i class="fas fa-dollar-sign"></i> Financials</li>
      </ul>

      <h3>Community</h3>
      <ul>
        <li data-section="editors-picks"><i class="fas fa-star"></i> Editors' picks</li>
        <li data-section="top"><i class="fas fa-medal"></i> Top</li>
        <li data-section="trending"><i class="fas fa-fire"></i> Trending</li>
      </ul>
    </div>

    <!-- Main Content -->
    <div class="main">
      <div class="top-bar">
        <i class="fas fa-search search-icon"></i>
        <input type="text" class="search-input" placeholder="Search" id="global-search">
      </div>

      <div class="tabs">
        <button class="tab-btn active" data-tab="indicators">Indicators</button>
        <button class="tab-btn" data-tab="strategies">Strategies</button>
        <button class="tab-btn" data-tab="profiles">Profiles</button>
        <button class="tab-btn" data-tab="patterns">Patterns</button>
      </div>

      <div class="content">
        <ul id="indicator-list" class="indicator-list"></ul>
      </div>
    </div>
  </div>
</div>

<footer class="footer"><div class="container">© 2025 TradeVision. Open Source.</div></footer>

<script>
// Test if buttons are working
console.log("Script loaded - testing button functionality");

/* ──────────────────────────────────────
   1. Theme toggle - TESTED WORKING
   ────────────────────────────────────── */
const themeBtn = document.getElementById('theme-toggle');
console.log("Theme button found:", themeBtn);

if (themeBtn) {
  const themeIcon = themeBtn.querySelector('i');
  themeBtn.addEventListener('click', () => {
    console.log("Theme button clicked!");
    const isDark = document.body.getAttribute('data-theme') === 'dark';
    document.body.setAttribute('data-theme', isDark ? 'light' : 'dark');
    themeIcon.classList.toggle('fa-moon'); 
    themeIcon.classList.toggle('fa-sun');
    localStorage.setItem('theme', isDark ? 'light' : 'dark');
  });
  
  // Apply saved theme
  const saved = localStorage.getItem('theme') || 'dark';
  document.body.setAttribute('data-theme', saved);
  if (saved === 'light') {
    themeIcon.classList.replace('fa-moon','fa-sun');
  }
}

/* ──────────────────────────────────────
   2. Data - Using hardcoded data since technicalindicators might not load
   ────────────────────────────────────── */
const indicators = [
  "Time Price Opportunity", "Session Time Price Opportunity", "Auto Anchored Volume Profile",
  "Fixed Range Volume Profile", "Periodic Volume Profile", "Session Volume Profile",
  "Session Volume Profile HD", "Visible Range Volume Profile", "RSI", "MACD", "Bollinger Bands",
  "Stochastic Oscillator", "Moving Average", "Volume Weighted Average Price", "Ichimoku Cloud",
  "Parabolic SAR", "Average True Range", "Commodity Channel Index", "Williams %R", "Money Flow Index"
];

const strategies = [
  "BarUpDn Strategy", "Bollinger Bands Strategy", "Bollinger Bands Strategy dire",
  "ChannelBreakOutStrategy", "Consecutive Up/Down Strategy", "Greedy Strategy",
  "Inside Bar Strategy", "Keltner Channels Strategy", "MACD Strategy",
  "Momentum Strategy", "MovingAvgLine Cross", "RSI Divergence Strategy", 
  "Support Resistance Strategy", "Trend Following Strategy", "Mean Reversion Strategy"
];

const profiles = [
  "Fixed Range Volume Profile", "Periodic Volume Profile", "Session Volume Profile",
  "Session Volume Profile HD", "Visible Range Volume Profile", "Volume Delta Profile",
  "Volume Cluster Profile", "Market Profile", "Time-based Volume Profile"
];

const patterns = [
  "All Chart Patterns", "Bearish Flag Chart Pattern", "Bullish Flag Chart Pattern",
  "Cup and Handle Chart Pattern", "Inverted Cup and Handle Chart Pattern",
  "Double Bottom Chart Pattern", "Double Top Chart Pattern", "Elliott Wave Chart Pattern",
  "Head and Shoulders Chart Pattern", "Inverted Head and Shoulders Chart Pattern",
  "Bearish Pennant Chart Pattern", "Bullish Pennant Chart Pattern", "Triangle Patterns",
  "Wedges Patterns", "Rectangle Patterns"
];

// Fallback technical indicators if library doesn't load
const fallbackIndicators = [
  "SMA", "EMA", "WMA", "DEMA", "TEMA", "TRIMA", "KAMA", "MAMA", "VWAP", "VWMA", 
  "HULLMA", "RSI", "STOCH", "STOCHF", "STOCHRSI", "MACD", "ADX", "AROON", 
  "CCI", "ATR", "BOLLINGER", "ADOSC", "OBV", "TRIX", "ULTOSC", "DX", "MINUS_DI", 
  "PLUS_DI", "MINUS_DM", "PLUS_DM", "WILLR", "TSF", "CORREL", "LINEARREG", 
  "LINEARREG_ANGLE", "LINEARREG_INTERCEPT", "LINEARREG_SLOPE", "STDDEV"
];

// Merge all technical indicators
const allTechnicals = [...new Set([...indicators, ...fallbackIndicators])].sort();

/* ──────────────────────────────────────
   3. Render list - FIXED
   ────────────────────────────────────── */
const list = document.getElementById('indicator-list');
let currentData = allTechnicals;
let currentTab = 'indicators';
let currentSection = 'technicals';

function renderList(filter = '') {
  console.log("Rendering list for tab:", currentTab, "with filter:", filter);
  
  list.innerHTML = '';
  
  let data = [];
  
  // Filter data based on current tab
  if (currentTab === 'indicators') {
    data = allTechnicals;
  } else if (currentTab === 'strategies') {
    data = strategies;
  } else if (currentTab === 'profiles') {
    data = profiles;
  } else if (currentTab === 'patterns') {
    data = patterns;
  }
  
  // Apply search filter
  data = data.filter(i => i.toLowerCase().includes(filter.toLowerCase()));
  
  if (data.length === 0) {
    list.innerHTML = `
      <div class="empty-state">
        <i class="fas fa-search"></i>
        <h3>No items found</h3>
        <p>Try adjusting your search terms</p>
      </div>
    `;
    return;
  }
  
  data.forEach(item => {
    const li = document.createElement('li');
    li.className = 'indicator-item';
    li.dataset.name = item;
    
    // Check if item should have NEW badge
    const hasNewBadge = item.includes('HD') || item.includes('NEW') || Math.random() > 0.8;
    
    li.innerHTML = `
      <div>
        <span class="name">${item}</span>
        ${hasNewBadge ? '<span class="new">NEW</span>' : ''}
      </div>
      <button class="add-btn" title="Add to chart">+</button>
    `;
    
    // Add click event for the entire item
    li.addEventListener('click', (e) => {
      console.log("Item clicked:", item);
      if (!e.target.classList.contains('add-btn')) {
        showIndicatorDetails(item);
      }
    });
    
    // Add click event for the add button
    const addBtn = li.querySelector('.add-btn');
    addBtn.addEventListener('click', e => {
      e.stopPropagation();
      console.log("Add button clicked for:", item);
      addToChart(item);
    });
    
    list.appendChild(li);
  });
  
  console.log("Rendered", data.length, "items");
}

function showIndicatorDetails(name) {
  console.log("Showing details for:", name);
  alert(`📊 ${name}\n\nDescription: This indicator helps analyze market trends and patterns.\n\nClick the '+' button to add it to your chart.`);
}

/* ──────────────────────────────────────
   4. Tab Switching - FIXED
   ────────────────────────────────────── */
const tabButtons = document.querySelectorAll('.tab-btn');
console.log("Found tab buttons:", tabButtons.length);

tabButtons.forEach(btn => {
  btn.addEventListener('click', () => {
    console.log("Tab button clicked:", btn.dataset.tab);
    
    // Remove active class from all tabs
    tabButtons.forEach(b => b.classList.remove('active'));
    
    // Add active class to clicked tab
    btn.classList.add('active');
    
    // Update current tab and render data
    currentTab = btn.dataset.tab;
    renderList(document.getElementById('global-search').value);
  });
});

/* ──────────────────────────────────────
   5. Sidebar Navigation - FIXED
   ────────────────────────────────────── */
const sidebarItems = document.querySelectorAll('.sidebar li');
console.log("Found sidebar items:", sidebarItems.length);

sidebarItems.forEach(item => {
  item.addEventListener('click', () => {
    console.log("Sidebar item clicked:", item.dataset.section);
    
    // Remove active class from all sidebar items
    sidebarItems.forEach(i => i.classList.remove('active'));
    
    // Add active class to clicked item
    item.classList.add('active');
    
    // Update current section
    currentSection = item.dataset.section;
    
    // Show appropriate message based on section
    let message = "";
    switch(currentSection) {
      case 'my-scripts':
        message = "Showing your personal scripts and indicators";
        break;
      case 'invite-only':
        message = "Showing private invite-only indicators";
        break;
      case 'technicals':
        message = "Showing technical analysis indicators";
        break;
      case 'financials':
        message = "Showing financial metrics and ratios";
        break;
      case 'editors-picks':
        message = "Showing curated picks from our editors";
        break;
      case 'top':
        message = "Showing top-rated community indicators";
        break;
      case 'trending':
        message = "Showing currently trending indicators";
        break;
    }
    
    console.log(message);
    
    // For demo purposes, show a brief notification
    const notification = document.createElement('div');
    notification.style.cssText = `
      position: fixed;
      top: 100px;
      right: 20px;
      background: var(--accent);
      color: white;
      padding: 10px 15px;
      border-radius: 5px;
      z-index: 1000;
      font-size: 14px;
    `;
    notification.textContent = message;
    document.body.appendChild(notification);
    
    setTimeout(() => {
      document.body.removeChild(notification);
    }, 2000);
    
    // Re-render the list with current tab data
    renderList(document.getElementById('global-search').value);
  });
});

/* ──────────────────────────────────────
   6. Search - FIXED
   ────────────────────────────────────── */
const searchInput = document.getElementById('global-search');
searchInput.addEventListener('input', e => {
  console.log("Search input:", e.target.value);
  renderList(e.target.value);
});

/* ──────────────────────────────────────
   7. Add to Chart - FIXED
   ────────────────────────────────────── */
function addToChart(name) {
  console.log("Adding to chart:", name);
  
  // Get current indicators from localStorage
  let list = JSON.parse(localStorage.getItem('chartIndicators') || '[]');
  
  if (!list.includes(name)) {
    list.push(name);
    localStorage.setItem('chartIndicators', JSON.stringify(list));
    
    // Visual feedback
    const originalText = event.target.textContent;
    event.target.textContent = '✓';
    event.target.style.background = '#26a69a';
    
    setTimeout(() => {
      event.target.textContent = originalText;
      event.target.style.background = '';
    }, 1000);
    
    console.log(`✅ ${name} added to chart!`);
  } else {
    console.log(`ℹ️ ${name} is already on the chart.`);
    event.target.textContent = '✓';
    setTimeout(() => {
      event.target.textContent = '+';
    }, 1000);
  }
}

/* ──────────────────────────────────────
   8. Initialize - FIXED
   ────────────────────────────────────── */
document.addEventListener('DOMContentLoaded', () => {
  console.log("DOM fully loaded - initializing app");
  
  // Initial render
  renderList();
  
  // Add some sample personal data to localStorage
  if (!localStorage.getItem('myScripts')) {
    localStorage.setItem('myScripts', JSON.stringify([
      "My Custom RSI",
      "Volume Breakout Strategy", 
      "Personal Trend Indicator",
      "Custom MACD Settings"
    ]));
  }
  
  console.log("App initialized successfully!");
});

// Test that all event listeners are working
console.log("Event listeners attached to:");
console.log("- Theme toggle button");
console.log("-", tabButtons.length, "tab buttons"); 
console.log("-", sidebarItems.length, "sidebar items");
console.log("- Search input");
console.log("- Add buttons will be attached when items are rendered");
</script>
</body>
</html>
