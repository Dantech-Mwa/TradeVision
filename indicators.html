<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Indicators â€“ TradeVision</title>
  <meta name="description" content="Free professional crypto charts with 100+ indicators, real-time data, drawing tools, and AI insights. Trade BTC, ETH, and more.">
<meta name="robots" content="index, follow">
  <link rel="icon" href="assets/icons/chart.svg" type="image/svg+xml">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    :root{
      --bg:#141518;--bg-light:#1e222d;--text:#d1d4dc;--text-light:#9ea1b5;
      --accent:#2962ff;--green:#26a69a;--red:#ef5350;--border:#2d313e;--card:#1e222d;
      --sidebar-bg:#1a1d29;--sidebar-hover:#252932;--sidebar-active:#2962ff;
    }
    [data-theme="light"]{
      --bg:#ffffff;--bg-light:#f8f9fa;--text:#2d3748;--text-light:#718096;
      --accent:#2962ff;--green:#26a69a;--red:#ef5350;--border:#e2e8f0;--card:#ffffff;
      --sidebar-bg:#f1f3f5;--sidebar-hover:#e2e8f0;--sidebar-active:#2962ff;
    }
    *,*::before,*::after{box-sizing:border-box;}
    body{margin:0;font-family:'Inter',sans-serif;background:var(--bg);color:var(--text);}
    a{color:var(--accent);text-decoration:none;}
    .container{max-width:1400px;margin:0 auto;padding:2rem 1rem;}
    .header{background:var(--bg-light);border-bottom:1px solid var(--border);padding:.75rem 0;position:sticky;top:0;z-index:100;}
    .flex-between{display:flex;justify-content:space-between;align-items:center;}
    .logo{font-weight:700;font-size:1.4rem;color:var(--accent);}
    .logo i{font-size:1.5rem;}
    .nav-links a{margin:0 .75rem;font-weight:500;}
    .icon-btn{background:none;border:none;color:var(--text-light);font-size:1.2rem;cursor:pointer;padding:.5rem;}

    /* Panel Layout */
    .panel{display:flex;gap:1.5rem;height:calc(100vh - 120px);}
    .sidebar{width:260px;flex-shrink:0;background:var(--sidebar-bg);border-radius:12px;padding:1rem;overflow-y:auto;}
    .sidebar h3{font-size:.85rem;font-weight:600;color:var(--text-light);margin:1.5rem 0 .5rem;text-transform:uppercase;letter-spacing:.5px;}
    .sidebar ul{list-style:none;padding:0;margin:0;}
    .sidebar li{
      padding:.75rem 1rem;cursor:pointer;border-radius:8px;margin-bottom:.25rem;
      font-weight:500;display:flex;align-items:center;gap:.5rem;transition:.2s;
    }
    .sidebar li:hover{background:var(--sidebar-hover);}
    .sidebar li.active{background:var(--sidebar-active);color:white;}
    .sidebar li i{font-size:1rem;}

    .main{flex:1;overflow:hidden;display:flex;flex-direction:column;}
    .top-bar{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:1rem;margin-bottom:1rem;position:relative;}
    .search-input{
      width:100%;padding:.75rem 1rem .75rem 2.5rem;border:none;background:transparent;
      color:var(--text);font-size:1rem;
    }
    .search-input:focus{outline:none;}
    .search-icon{position:absolute;left:.75rem;top:50%;transform:translateY(-50%);color:var(--text-light);}

    .tabs{display:flex;gap:0;border-bottom:1px solid var(--border);margin-bottom:1rem;}
    .tab-btn{
      padding:.75rem 1.5rem;border:none;background:none;color:var(--text-light);
      font-weight:500;cursor:pointer;position:relative;transition:color .2s;
    }
    .tab-btn:hover{color:var(--text);}
    .tab-btn.active{color:var(--accent);font-weight:600;}
    .tab-btn.active::after{
      content:'';position:absolute;bottom:-1px;left:0;right:0;height:2px;
      background:var(--accent);border-radius:1px;
    }

    .content{flex:1;overflow-y:auto;padding-right:.5rem;}
    .indicator-list{list-style:none;padding:0;margin:0;}
    .indicator-item{
      padding:.75rem 1rem;cursor:pointer;border-bottom:1px solid var(--border);
      display:flex;justify-content:space-between;align-items:center;
      transition:.2s;
    }
    .indicator-item:hover{background:var(--bg-light);}
    .indicator-item .name{font-weight:500;}
    .indicator-item .new{
      background:#ff9800;color:white;padding:.2rem .4rem;font-size:.65rem;
      border-radius:4px;margin-left:.5rem;
    }
    .indicator-item .add-btn{
      background:var(--accent);color:white;border:none;border-radius:4px;
      width:28px;height:28px;font-size:.9rem;cursor:pointer;
      transition:background-color 0.2s;
    }
    .indicator-item .add-btn:hover{
      background:#1e53e5;
    }

    .empty-state{
      text-align:center;padding:3rem;color:var(--text-light);
    }
    .empty-state i{font-size:3rem;margin-bottom:1rem;opacity:.5;}

    .footer{background:var(--bg-light);border-top:1px solid var(--border);padding:1rem 0;font-size:.8rem;text-align:center;color:var(--text-light);}

    /* Modal Styles */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.7);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }
    
    .modal-content {
      background: var(--card);
      border-radius: 12px;
      padding: 2rem;
      max-width: 500px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
    }
    
    .modal-header {
      display: flex;
      justify-content: between;
      align-items: center;
      margin-bottom: 1.5rem;
    }
    
    .modal-title {
      font-size: 1.3rem;
      font-weight: 600;
      margin: 0;
    }
    
    .close-modal {
      background: none;
      border: none;
      color: var(--text-light);
      font-size: 1.5rem;
      cursor: pointer;
      padding: 0;
      width: 30px;
      height: 30px;
    }
    
    .param-group {
      margin-bottom: 1rem;
    }
    
    .param-label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
    }
    
    .param-input {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid var(--border);
      border-radius: 6px;
      background: var(--bg);
      color: var(--text);
    }
    
    .modal-actions {
      display: flex;
      gap: 1rem;
      margin-top: 2rem;
    }
    
    .btn {
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 500;
      transition: background-color 0.2s;
    }
    
    .btn-primary {
      background: var(--accent);
      color: white;
    }
    
    .btn-secondary {
      background: var(--bg-light);
      color: var(--text);
    }
  </style>
</head>

<body data-theme="dark">

<header class="header">
  <div class="container flex-between">
    <div class="logo"><a href="index.html"><i class="fas fa-chart-line"></i> TradeVision</a></div>
    <nav class="nav-links">
      <a href="chart.html">Chart</a>
      <a href="watchlist.html">Watchlist</a>
      <a href="screener.html">Screener</a>
      <a href="ideas.html">Ideas</a>
      <a href="alerts.html">Alerts</a>
    </nav>
    <button id="theme-toggle" class="icon-btn"><i class="fas fa-moon"></i></button>
  </div>
</header>

<div class="container">
  <h1 style="margin-bottom:.5rem;">Indicators and Strategies</h1>

  <div class="panel">
    <!-- Sidebar -->
    <div class="sidebar">
      <h3>Personal</h3>
      <ul>
        <li data-section="my-scripts"><i class="fas fa-user"></i> My scripts</li>
        <li data-section="invite-only"><i class="fas fa-lock"></i> Invite-only</li>
      </ul>

      <h3>Built-in</h3>
      <ul>
        <li class="active" data-section="technicals"><i class="fas fa-chart-line"></i> Technicals</li>
        <li data-section="financials"><i class="fas fa-dollar-sign"></i> Financials</li>
      </ul>

      <h3>Community</h3>
      <ul>
        <li data-section="editors-picks"><i class="fas fa-star"></i> Editors' picks</li>
        <li data-section="top"><i class="fas fa-medal"></i> Top</li>
        <li data-section="trending"><i class="fas fa-fire"></i> Trending</li>
      </ul>
    </div>

    <!-- Main Content -->
    <div class="main">
      <div class="top-bar">
        <i class="fas fa-search search-icon"></i>
        <input type="text" class="search-input" placeholder="Search" id="global-search">
      </div>

      <div class="tabs">
        <button class="tab-btn active" data-tab="indicators">Indicators</button>
        <button class="tab-btn" data-tab="strategies">Strategies</button>
        <button class="tab-btn" data-tab="profiles">Profiles</button>
        <button class="tab-btn" data-tab="patterns">Patterns</button>
      </div>

      <div class="content">
        <ul id="indicator-list" class="indicator-list"></ul>
      </div>
    </div>
  </div>
</div>

<!-- Indicator Configuration Modal -->
<div id="indicator-modal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3 class="modal-title" id="modal-title">Configure Indicator</h3>
      <button class="close-modal">&times;</button>
    </div>
    <div id="modal-body">
      <!-- Dynamic content will be inserted here -->
    </div>
    <div class="modal-actions">
      <button class="btn btn-secondary" id="cancel-btn">Cancel</button>
      <button class="btn btn-primary" id="apply-btn">Apply to Chart</button>
    </div>
  </div>
</div>

<footer class="footer"><div class="container">Â© 2025 TradeVision. Open Source.</div></footer>

<script>
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// INDICATOR MATHEMATICAL FUNCTIONS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

const IndicatorMath = {
  // Simple Moving Average
  sma(data, period, key = 'close') {
    const result = new Array(data.length).fill(null);
    for (let i = period - 1; i < data.length; i++) {
      let sum = 0;
      for (let j = 0; j < period; j++) {
        sum += data[i - j][key];
      }
      result[i] = sum / period;
    }
    return result;
  },

  // Exponential Moving Average
  ema(data, period, key = 'close') {
    const result = new Array(data.length).fill(null);
    const k = 2 / (period + 1);
    
    // First EMA value is SMA
    let sum = 0;
    for (let i = 0; i < period; i++) {
      sum += data[i][key];
    }
    result[period - 1] = sum / period;
    
    // Calculate subsequent EMA values
    for (let i = period; i < data.length; i++) {
      result[i] = (data[i][key] * k) + (result[i - 1] * (1 - k));
    }
    return result;
  },

  // Relative Strength Index
  rsi(data, period = 14) {
    const result = new Array(data.length).fill(null);
    const gains = [];
    const losses = [];
    
    // Calculate gains and losses
    for (let i = 1; i < data.length; i++) {
      const change = data[i].close - data[i - 1].close;
      gains.push(change > 0 ? change : 0);
      losses.push(change < 0 ? Math.abs(change) : 0);
    }
    
    // Calculate first RSI value
    let avgGain = gains.slice(0, period).reduce((a, b) => a + b, 0) / period;
    let avgLoss = losses.slice(0, period).reduce((a, b) => a + b, 0) / period;
    
    result[period] = 100 - (100 / (1 + (avgGain / (avgLoss || 0.001))));
    
    // Calculate subsequent RSI values
    for (let i = period + 1; i < data.length; i++) {
      avgGain = ((avgGain * (period - 1)) + gains[i - 1]) / period;
      avgLoss = ((avgLoss * (period - 1)) + losses[i - 1]) / period;
      result[i] = 100 - (100 / (1 + (avgGain / (avgLoss || 0.001))));
    }
    
    return result;
  },

  // Moving Average Convergence Divergence
  macd(data, fastPeriod = 12, slowPeriod = 26, signalPeriod = 9) {
    const fastEMA = this.ema(data, fastPeriod);
    const slowEMA = this.ema(data, slowPeriod);
    
    const macdLine = fastEMA.map((fast, i) => 
      fast !== null && slowEMA[i] !== null ? fast - slowEMA[i] : null
    );
    
    // Calculate signal line (EMA of MACD line)
    const signalLine = new Array(data.length).fill(null);
    let signalSum = 0;
    let signalCount = 0;
    
    for (let i = slowPeriod - 1; i < slowPeriod - 1 + signalPeriod; i++) {
      if (macdLine[i] !== null) {
        signalSum += macdLine[i];
        signalCount++;
      }
    }
    
    if (signalCount > 0) {
      signalLine[slowPeriod - 1 + signalPeriod - 1] = signalSum / signalCount;
      
      const k = 2 / (signalPeriod + 1);
      for (let i = slowPeriod + signalPeriod - 1; i < data.length; i++) {
        signalLine[i] = (macdLine[i] * k) + (signalLine[i - 1] * (1 - k));
      }
    }
    
    const histogram = macdLine.map((macd, i) => 
      macd !== null && signalLine[i] !== null ? macd - signalLine[i] : null
    );
    
    return { macdLine, signalLine, histogram };
  },

  // Bollinger Bands
  bollingerBands(data, period = 20, multiplier = 2) {
    const sma = this.sma(data, period);
    const upper = new Array(data.length).fill(null);
    const lower = new Array(data.length).fill(null);
    
    for (let i = period - 1; i < data.length; i++) {
      let sumSquared = 0;
      for (let j = 0; j < period; j++) {
        sumSquared += Math.pow(data[i - j].close - sma[i], 2);
      }
      const stdDev = Math.sqrt(sumSquared / period);
      upper[i] = sma[i] + (multiplier * stdDev);
      lower[i] = sma[i] - (multiplier * stdDev);
    }
    
    return { upper, middle: sma, lower };
  },

  // Stochastic Oscillator
  stochastic(data, kPeriod = 14, dPeriod = 3) {
    const k = new Array(data.length).fill(null);
    const d = new Array(data.length).fill(null);
    
    for (let i = kPeriod - 1; i < data.length; i++) {
      let high = -Infinity;
      let low = Infinity;
      
      for (let j = 0; j < kPeriod; j++) {
        high = Math.max(high, data[i - j].high);
        low = Math.min(low, data[i - j].low);
      }
      
      k[i] = ((data[i].close - low) / (high - low)) * 100;
    }
    
    // Calculate %D (SMA of %K)
    for (let i = kPeriod + dPeriod - 2; i < data.length; i++) {
      let sum = 0;
      for (let j = 0; j < dPeriod; j++) {
        sum += k[i - j];
      }
      d[i] = sum / dPeriod;
    }
    
    return { k, d };
  },

  // Average True Range
  atr(data, period = 14) {
    const tr = new Array(data.length).fill(null);
    
    for (let i = 1; i < data.length; i++) {
      const highLow = data[i].high - data[i].low;
      const highClose = Math.abs(data[i].high - data[i - 1].close);
      const lowClose = Math.abs(data[i].low - data[i - 1].close);
      tr[i] = Math.max(highLow, highClose, lowClose);
    }
    
    return this.sma(tr.map((t, i) => ({ close: t })), period);
  },

  // Commodity Channel Index
  cci(data, period = 20) {
    const result = new Array(data.length).fill(null);
    
    for (let i = period - 1; i < data.length; i++) {
      let sumTP = 0;
      const tps = [];
      
      for (let j = 0; j < period; j++) {
        const tp = (data[i - j].high + data[i - j].low + data[i - j].close) / 3;
        sumTP += tp;
        tps.push(tp);
      }
      
      const smaTP = sumTP / period;
      let meanDev = 0;
      
      for (let j = 0; j < period; j++) {
        meanDev += Math.abs(tps[j] - smaTP);
      }
      meanDev /= period;
      
      const currentTP = (data[i].high + data[i].low + data[i].close) / 3;
      result[i] = (currentTP - smaTP) / (0.015 * meanDev);
    }
    
    return result;
  },

  // Volume Weighted Average Price
  vwap(data) {
    const result = new Array(data.length).fill(null);
    let cumulativePV = 0;
    let cumulativeVolume = 0;
    
    for (let i = 0; i < data.length; i++) {
      const typicalPrice = (data[i].high + data[i].low + data[i].close) / 3;
      cumulativePV += typicalPrice * data[i].volume;
      cumulativeVolume += data[i].volume;
      result[i] = cumulativePV / cumulativeVolume;
    }
    
    return result;
  },

  // On Balance Volume
  obv(data) {
    const result = new Array(data.length).fill(null);
    result[0] = data[0].volume;
    
    for (let i = 1; i < data.length; i++) {
      if (data[i].close > data[i - 1].close) {
        result[i] = result[i - 1] + data[i].volume;
      } else if (data[i].close < data[i - 1].close) {
        result[i] = result[i - 1] - data[i].volume;
      } else {
        result[i] = result[i - 1];
      }
    }
    
    return result;
  },

  // Williams %R
  williamsR(data, period = 14) {
    const result = new Array(data.length).fill(null);
    
    for (let i = period - 1; i < data.length; i++) {
      let highest = -Infinity;
      let lowest = Infinity;
      
      for (let j = 0; j < period; j++) {
        highest = Math.max(highest, data[i - j].high);
        lowest = Math.min(lowest, data[i - j].low);
      }
      
      result[i] = ((highest - data[i].close) / (highest - lowest)) * -100;
    }
    
    return result;
  }
};

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// INDICATOR CONFIGURATIONS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

const IndicatorConfigs = {
  'RSI': {
    name: 'Relative Strength Index (RSI)',
    description: 'Measures the speed and change of price movements',
    defaultParams: { period: 14 },
    calculate: (data, params) => IndicatorMath.rsi(data, params.period)
  },
  'MACD': {
    name: 'Moving Average Convergence Divergence (MACD)',
    description: 'Trend-following momentum indicator',
    defaultParams: { fastPeriod: 12, slowPeriod: 26, signalPeriod: 9 },
    calculate: (data, params) => IndicatorMath.macd(data, params.fastPeriod, params.slowPeriod, params.signalPeriod)
  },
  'BOLLINGER BANDS': {
    name: 'Bollinger Bands',
    description: 'Volatility bands placed above and below a moving average',
    defaultParams: { period: 20, multiplier: 2 },
    calculate: (data, params) => IndicatorMath.bollingerBands(data, params.period, params.multiplier)
  },
  'STOCHASTIC': {
    name: 'Stochastic Oscillator',
    description: 'Momentum indicator comparing closing price to price range',
    defaultParams: { kPeriod: 14, dPeriod: 3 },
    calculate: (data, params) => IndicatorMath.stochastic(data, params.kPeriod, params.dPeriod)
  },
  'SMA': {
    name: 'Simple Moving Average (SMA)',
    description: 'Average of closing prices over a specified period',
    defaultParams: { period: 20 },
    calculate: (data, params) => ({ value: IndicatorMath.sma(data, params.period) })
  },
  'EMA': {
    name: 'Exponential Moving Average (EMA)',
    description: 'Weighted average giving more importance to recent prices',
    defaultParams: { period: 20 },
    calculate: (data, params) => ({ value: IndicatorMath.ema(data, params.period) })
  },
  'ATR': {
    name: 'Average True Range (ATR)',
    description: 'Measures market volatility',
    defaultParams: { period: 14 },
    calculate: (data, params) => ({ value: IndicatorMath.atr(data, params.period) })
  },
  'CCI': {
    name: 'Commodity Channel Index (CCI)',
    description: 'Identifies cyclical trends in prices',
    defaultParams: { period: 20 },
    calculate: (data, params) => ({ value: IndicatorMath.cci(data, params.period) })
  },
  'VWAP': {
    name: 'Volume Weighted Average Price (VWAP)',
    description: 'Average price weighted by volume',
    defaultParams: {},
    calculate: (data, params) => ({ value: IndicatorMath.vwap(data) })
  },
  'OBV': {
    name: 'On Balance Volume (OBV)',
    description: 'Momentum indicator using volume flow',
    defaultParams: {},
    calculate: (data, params) => ({ value: IndicatorMath.obv(data) })
  }
};

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// UI FUNCTIONALITY
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

// Test if buttons are working
console.log("Script loaded - testing button functionality");

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   1. Theme toggle - TESTED WORKING
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const themeBtn = document.getElementById('theme-toggle');
console.log("Theme button found:", themeBtn);

if (themeBtn) {
  const themeIcon = themeBtn.querySelector('i');
  themeBtn.addEventListener('click', () => {
    console.log("Theme button clicked!");
    const isDark = document.body.getAttribute('data-theme') === 'dark';
    document.body.setAttribute('data-theme', isDark ? 'light' : 'dark');
    themeIcon.classList.toggle('fa-moon'); 
    themeIcon.classList.toggle('fa-sun');
    localStorage.setItem('theme', isDark ? 'light' : 'dark');
  });
  
  // Apply saved theme
  const saved = localStorage.getItem('theme') || 'dark';
  document.body.setAttribute('data-theme', saved);
  if (saved === 'light') {
    themeIcon.classList.replace('fa-moon','fa-sun');
  }
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   2. Data - Using hardcoded data since technicalindicators might not load
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const indicators = [
  "Time Price Opportunity", "Session Time Price Opportunity", "Auto Anchored Volume Profile",
  "Fixed Range Volume Profile", "Periodic Volume Profile", "Session Volume Profile",
  "Session Volume Profile HD", "Visible Range Volume Profile", "RSI", "MACD", "Bollinger Bands",
  "Stochastic Oscillator", "Moving Average", "Volume Weighted Average Price", "Ichimoku Cloud",
  "Parabolic SAR", "Average True Range", "Commodity Channel Index", "Williams %R", "Money Flow Index"
];

const strategies = [
  "BarUpDn Strategy", "Bollinger Bands Strategy", "Bollinger Bands Strategy dire",
  "ChannelBreakOutStrategy", "Consecutive Up/Down Strategy", "Greedy Strategy",
  "Inside Bar Strategy", "Keltner Channels Strategy", "MACD Strategy",
  "Momentum Strategy", "MovingAvgLine Cross", "RSI Divergence Strategy", 
  "Support Resistance Strategy", "Trend Following Strategy", "Mean Reversion Strategy"
];

const profiles = [
  "Fixed Range Volume Profile", "Periodic Volume Profile", "Session Volume Profile",
  "Session Volume Profile HD", "Visible Range Volume Profile", "Volume Delta Profile",
  "Volume Cluster Profile", "Market Profile", "Time-based Volume Profile"
];

const patterns = [
  "All Chart Patterns", "Bearish Flag Chart Pattern", "Bullish Flag Chart Pattern",
  "Cup and Handle Chart Pattern", "Inverted Cup and Handle Chart Pattern",
  "Double Bottom Chart Pattern", "Double Top Chart Pattern", "Elliott Wave Chart Pattern",
  "Head and Shoulders Chart Pattern", "Inverted Head and Shoulders Chart Pattern",
  "Bearish Pennant Chart Pattern", "Bullish Pennant Chart Pattern", "Triangle Patterns",
  "Wedges Patterns", "Rectangle Patterns"
];

// Fallback technical indicators if library doesn't load
const fallbackIndicators = [
  "SMA", "EMA", "WMA", "DEMA", "TEMA", "TRIMA", "KAMA", "MAMA", "VWAP", "VWMA", 
  "HULLMA", "RSI", "STOCH", "STOCHF", "STOCHRSI", "MACD", "ADX", "AROON", 
  "CCI", "ATR", "BOLLINGER", "ADOSC", "OBV", "TRIX", "ULTOSC", "DX", "MINUS_DI", 
  "PLUS_DI", "MINUS_DM", "PLUS_DM", "WILLR", "TSF", "CORREL", "LINEARREG", 
  "LINEARREG_ANGLE", "LINEARREG_INTERCEPT", "LINEARREG_SLOPE", "STDDEV"
];

// Merge all technical indicators
const allTechnicals = [...new Set([...indicators, ...fallbackIndicators])].sort();

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   3. Render list - FIXED
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const list = document.getElementById('indicator-list');
let currentData = allTechnicals;
let currentTab = 'indicators';
let currentSection = 'technicals';

function renderList(filter = '') {
  console.log("Rendering list for tab:", currentTab, "with filter:", filter);
  
  list.innerHTML = '';
  
  let data = [];
  
  // Filter data based on current tab
  if (currentTab === 'indicators') {
    data = allTechnicals;
  } else if (currentTab === 'strategies') {
    data = strategies;
  } else if (currentTab === 'profiles') {
    data = profiles;
  } else if (currentTab === 'patterns') {
    data = patterns;
  }
  
  // Apply search filter
  data = data.filter(i => i.toLowerCase().includes(filter.toLowerCase()));
  
  if (data.length === 0) {
    list.innerHTML = `
      <div class="empty-state">
        <i class="fas fa-search"></i>
        <h3>No items found</h3>
        <p>Try adjusting your search terms</p>
      </div>
    `;
    return;
  }
  
  data.forEach(item => {
    const li = document.createElement('li');
    li.className = 'indicator-item';
    li.dataset.name = item;
    
    // Check if item should have NEW badge
    const hasNewBadge = item.includes('HD') || item.includes('NEW') || Math.random() > 0.8;
    
    li.innerHTML = `
      <div>
        <span class="name">${item}</span>
        ${hasNewBadge ? '<span class="new">NEW</span>' : ''}
      </div>
      <button class="add-btn" title="Add to chart">+</button>
    `;
    
    // Add click event for the entire item
    li.addEventListener('click', (e) => {
      console.log("Item clicked:", item);
      if (!e.target.classList.contains('add-btn')) {
        showIndicatorDetails(item);
      }
    });
    
    // Add click event for the add button
    const addBtn = li.querySelector('.add-btn');
    addBtn.addEventListener('click', e => {
      e.stopPropagation();
      console.log("Add button clicked for:", item);
      showIndicatorConfig(item);
    });
    
    list.appendChild(li);
  });
  
  console.log("Rendered", data.length, "items");
}

function showIndicatorDetails(name) {
  console.log("Showing details for:", name);
  
  const config = IndicatorConfigs[name.toUpperCase()];
  if (config) {
    alert(`ðŸ“Š ${config.name}\n\n${config.description}\n\nDefault Parameters:\n${JSON.stringify(config.defaultParams, null, 2)}\n\nClick the '+' button to configure and add to chart.`);
  } else {
    alert(`ðŸ“Š ${name}\n\nThis indicator helps analyze market trends and patterns.\n\nClick the '+' button to add it to your chart with default settings.`);
  }
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   4. Modal Functionality
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const modal = document.getElementById('indicator-modal');
const modalTitle = document.getElementById('modal-title');
const modalBody = document.getElementById('modal-body');
const closeModal = document.querySelector('.close-modal');
const cancelBtn = document.getElementById('cancel-btn');
const applyBtn = document.getElementById('apply-btn');

let currentIndicator = null;

function showIndicatorConfig(indicatorName) {
  currentIndicator = indicatorName.toUpperCase();
  const config = IndicatorConfigs[currentIndicator] || {
    name: indicatorName,
    description: 'Technical analysis indicator',
    defaultParams: { period: 14 },
    calculate: (data, params) => ({ value: IndicatorMath.sma(data, params.period) })
  };
  
  modalTitle.textContent = `Configure ${config.name}`;
  
  // Create parameter inputs
  let paramsHTML = '';
  if (Object.keys(config.defaultParams).length > 0) {
    paramsHTML = '<h4 style="margin-bottom: 1rem;">Parameters</h4>';
    for (const [key, value] of Object.entries(config.defaultParams)) {
      paramsHTML += `
        <div class="param-group">
          <label class="param-label">${key.toUpperCase()}</label>
          <input type="number" class="param-input" id="param-${key}" value="${value}" min="1">
        </div>
      `;
    }
  } else {
    paramsHTML = '<p>No parameters required for this indicator.</p>';
  }
  
  modalBody.innerHTML = `
    <p style="margin-bottom: 1.5rem; color: var(--text-light);">${config.description}</p>
    ${paramsHTML}
  `;
  
  modal.style.display = 'flex';
}

function closeIndicatorModal() {
  modal.style.display = 'none';
  currentIndicator = null;
}

function applyIndicatorToChart() {
  if (!currentIndicator) return;
  
  const config = IndicatorConfigs[currentIndicator] || {
    name: currentIndicator,
    defaultParams: { period: 14 },
    calculate: (data, params) => ({ value: IndicatorMath.sma(data, params.period) })
  };
  
  // Get parameter values
  const params = {};
  for (const key of Object.keys(config.defaultParams)) {
    const input = document.getElementById(`param-${key}`);
    if (input) {
      params[key] = parseInt(input.value) || config.defaultParams[key];
    }
  }
  
  // Save to localStorage for chart.html to use
  const chartIndicators = JSON.parse(localStorage.getItem('chartIndicators') || '[]');
  const indicatorConfig = {
    name: currentIndicator,
    params: params,
    timestamp: Date.now()
  };
  
  // Check if already exists
  const existingIndex = chartIndicators.findIndex(ind => ind.name === currentIndicator);
  if (existingIndex >= 0) {
    chartIndicators[existingIndex] = indicatorConfig;
  } else {
    chartIndicators.push(indicatorConfig);
  }
  
  localStorage.setItem('chartIndicators', JSON.stringify(chartIndicators));
  
  // Visual feedback
  applyBtn.textContent = 'âœ“ Added!';
  applyBtn.style.background = '#26a69a';
  
  setTimeout(() => {
    applyBtn.textContent = 'Apply to Chart';
    applyBtn.style.background = '';
    closeIndicatorModal();
    
    // Show success message
    const notification = document.createElement('div');
    notification.style.cssText = `
      position: fixed;
      top: 100px;
      right: 20px;
      background: #26a69a;
      color: white;
      padding: 10px 15px;
      border-radius: 5px;
      z-index: 1000;
      font-size: 14px;
    `;
    notification.textContent = `âœ… ${currentIndicator} added to chart!`;
    document.body.appendChild(notification);
    
    setTimeout(() => {
      document.body.removeChild(notification);
    }, 3000);
  }, 1000);
  
  console.log(`Added ${currentIndicator} to chart with params:`, params);
}

// Modal event listeners
closeModal.addEventListener('click', closeIndicatorModal);
cancelBtn.addEventListener('click', closeIndicatorModal);
applyBtn.addEventListener('click', applyIndicatorToChart);

// Close modal when clicking outside
modal.addEventListener('click', (e) => {
  if (e.target === modal) {
    closeIndicatorModal();
  }
});

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   5. Tab Switching - FIXED
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const tabButtons = document.querySelectorAll('.tab-btn');
console.log("Found tab buttons:", tabButtons.length);

tabButtons.forEach(btn => {
  btn.addEventListener('click', () => {
    console.log("Tab button clicked:", btn.dataset.tab);
    
    // Remove active class from all tabs
    tabButtons.forEach(b => b.classList.remove('active'));
    
    // Add active class to clicked tab
    btn.classList.add('active');
    
    // Update current tab and render data
    currentTab = btn.dataset.tab;
    renderList(document.getElementById('global-search').value);
  });
});

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   6. Sidebar Navigation - FIXED
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const sidebarItems = document.querySelectorAll('.sidebar li');
console.log("Found sidebar items:", sidebarItems.length);

sidebarItems.forEach(item => {
  item.addEventListener('click', () => {
    console.log("Sidebar item clicked:", item.dataset.section);
    
    // Remove active class from all sidebar items
    sidebarItems.forEach(i => i.classList.remove('active'));
    
    // Add active class to clicked item
    item.classList.add('active');
    
    // Update current section
    currentSection = item.dataset.section;
    
    // Show appropriate message based on section
    let message = "";
    switch(currentSection) {
      case 'my-scripts':
        message = "Showing your personal scripts and indicators";
        break;
      case 'invite-only':
        message = "Showing private invite-only indicators";
        break;
      case 'technicals':
        message = "Showing technical analysis indicators";
        break;
      case 'financials':
        message = "Showing financial metrics and ratios";
        break;
      case 'editors-picks':
        message = "Showing curated picks from our editors";
        break;
      case 'top':
        message = "Showing top-rated community indicators";
        break;
      case 'trending':
        message = "Showing currently trending indicators";
        break;
    }
    
    console.log(message);
    
    // For demo purposes, show a brief notification
    const notification = document.createElement('div');
    notification.style.cssText = `
      position: fixed;
      top: 100px;
      right: 20px;
      background: var(--accent);
      color: white;
      padding: 10px 15px;
      border-radius: 5px;
      z-index: 1000;
      font-size: 14px;
    `;
    notification.textContent = message;
    document.body.appendChild(notification);
    
    setTimeout(() => {
      document.body.removeChild(notification);
    }, 2000);
    
    // Re-render the list with current tab data
    renderList(document.getElementById('global-search').value);
  });
});

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   7. Search - FIXED
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const searchInput = document.getElementById('global-search');
searchInput.addEventListener('input', e => {
  console.log("Search input:", e.target.value);
  renderList(e.target.value);
});

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   8. Initialize - FIXED
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
document.addEventListener('DOMContentLoaded', () => {
  console.log("DOM fully loaded - initializing app");
  
  // Initial render
  renderList();
  
  // Add some sample personal data to localStorage
  if (!localStorage.getItem('myScripts')) {
    localStorage.setItem('myScripts', JSON.stringify([
      "My Custom RSI",
      "Volume Breakout Strategy", 
      "Personal Trend Indicator",
      "Custom MACD Settings"
    ]));
  }
  
  console.log("App initialized successfully!");
});

// Export functions for use in chart.html
window.IndicatorSystem = {
  IndicatorMath,
  IndicatorConfigs,
  calculateIndicator: (indicatorName, data, params) => {
    const config = IndicatorConfigs[indicatorName.toUpperCase()];
    if (config) {
      return config.calculate(data, params);
    } else {
      // Fallback to SMA for unknown indicators
      return { value: IndicatorMath.sma(data, params.period || 14) };
    }
  }
};

console.log("Indicator system loaded with 10 main indicators + fallback SMA");
</script>
</body>
</html>
